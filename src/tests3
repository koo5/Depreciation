
test(depreciationAsset_all_life_1,[all(x=[x])]):-
    Asset_id = car123,
    T1 = 10000,
    T2 = 10213,
    Begin_value = 1000,
    Method = diminishing_value,
    Year_of_depreciation = 1,
    depreciationAsset(Asset_id,T1,T2,Begin_value,End_value,Method,Year_of_depreciation,
        Life,false,_,0,Final_depreciation_value),
    Expected = [[1000,not_in_pool(car123),10000,10044,885.6776881215987,48.21917808219178,40],
        [951.7808219178082,in_pool(car123,general_pool),10044,10213,885.6776881215987,66.10313379620942,15]],
    round_term(Life, Life_r),
    round_term(Expected, Expected_r),
    format(user_error,'~ngot:~n~q',[Life_r]),
    format(user_error,'~nexpected:~n~q',[Expected_r]),
    assertion(terms_with_floats_close_enough(Life, Expected)),
    assertion(floats_close_enough(Final_depreciation_value,114.3223118784012)),
    Correct_end_value is Begin_value - Final_depreciation_value,
    assertion(floats_close_enough(Correct_end_value, End_value)).


test(depreciationAsset_all_life_2,[all(x=[x])]):-
    Asset_id = car456,
    T1 = 9300,
    T2 = 9500,
    Begin_value = 1000,
    Method = diminishing_value,
    Year_of_depreciation = 1,
    depreciationAsset(Asset_id,T1,T2,Begin_value,End_value,Method,Year_of_depreciation,Life,
        false,_,0,Final_depreciation_value),
    Expected = [[1000,not_in_pool(car456),9300,9313,916.9858087821355,6.678082191780821,18.75],
        [993.3219178082192,in_pool(car456,general_pool),9313,9500,916.9858087821355,76.33610902608369,15]],
    round_term(Life, Life_r),
    round_term(Expected, Expected_r),
    format(user_error,'~ngot:~n~q',[Life_r]),
    format(user_error,'~nexpected:~n~q',[Expected_r]),
    assertion(terms_with_floats_close_enough(Life,Expected)),
    assertion(floats_close_enough(Final_depreciation_value,83.01419121786451)),
    Correct_end_value is Begin_value - Final_depreciation_value,
    assertion(floats_close_enough(Correct_end_value,End_value)).

%%%
test(depreciationAsset_all_life_3,[all(x=[x])]):-
    Asset_id = car123,
    T1 = 9982,
    T2 = 10050,
    Begin_value = 1000,
    Method = diminishing_value,
    Year_of_depreciation = 1,
    depreciationAsset(Asset_id,T1,T2,Begin_value,End_value,Method,Year_of_depreciation,
        Life,false,_,0,Final_depreciation_value),
    Expected = [[1000,not_in_pool(car123),9982,10044,929.7565772189904,67.94520547945206,40],
        [932.054794520548,in_pool(car123,general_pool),10044,10050,929.7565772189904,2.298217301557515,15]],
    round_term(Life, Life_r),
    round_term(Expected, Expected_r),
    format(user_error,'~ngot:~n~q',[Life_r]),
    format(user_error,'~nexpected:~n~q',[Expected_r]),
	assertion(terms_with_floats_close_enough(Life,Expected)),
    assertion(floats_close_enough(Final_depreciation_value,70.24342278100957)),
    Correct_end_value is Begin_value - Final_depreciation_value,
    assertion(floats_close_enough(End_value,Correct_end_value)).

test(depreciationAsset_only_in_pool_1,[all(x=[x])]):-
    Asset_id = car123,
    T1 = 10000,
    T2 = 10213,
    Begin_value = 1000,
    Method = diminishing_value,
    Year_of_depreciation = 1,
    depreciationAsset(Asset_id,T1,T2,Begin_value,_,Method,Year_of_depreciation,Life,true,
        general_pool,0,Final_depreciation_value),
    Expected = [[1000,not_in_pool(car123),10000,10044,885.6776881215987,48.21917808219178,40],
        [951.7808219178082,in_pool(car123,general_pool),10044,10213,885.6776881215987,66.10313379620942,15]],
    round_term(Life, Life_r),
    round_term(Expected, Expected_r),
    format(user_error,'~ngot:~n~q',[Life_r]),
    format(user_error,'~nexpected:~n~q',[Expected_r]),
    assertion(terms_with_floats_close_enough(Life,Expected)),
    assertion(floats_close_enough(Final_depreciation_value,66.10313379620942)).

test(depreciationAsset_only_in_pool_2,[all(x=[x])]):-
    Asset_id = car456,
    T1 = 9300,
    T2 = 9500,
    Begin_value = 1000,
    Method = diminishing_value,
    Year_of_depreciation = 1,
    depreciationAsset(Asset_id,T1,T2,Begin_value,_,Method,Year_of_depreciation,Life,true,
        general_pool,0,Final_depreciation_value),
    Expected = [[1000,not_in_pool(car456),9300,9313,916.9858087821355,6.678082191780821,18.75],
        [993.3219178082192,in_pool(car456,general_pool),9313,9500,916.9858087821355,76.33610902608369,15]],
    round_term(Life, Life_r),
    round_term(Expected, Expected_r),
    format(user_error,'~ngot:~n~q',[Life_r]),
    format(user_error,'~nexpected:~n~q',[Expected_r]),
    assertion(terms_with_floats_close_enough(Life,Expected)),
    assertion(floats_close_enough(Final_depreciation_value,76.33610902608369)).


test(depreciation_between_start_date_and_other_date_while_in_pool_1,[all(x=[x])]):-
    /* Parameters of predicate
    Initial_value, 							% value at start of year / Asset Base Value
    Method, 								% Diminishing Value / Prime Cost
    date(From_year, From_Month, From_day),
    To_date,								% date for which depreciation should be computed
    Asset_id,								% Asset
    Rates,
    Depreciation_year, 						% 1,2,3...
    While_in_pool,
    What_pool,
    Initial_depreciation_value,
    Total_depreciation_value*/
    depreciation_between_start_date_and_other_date(1000,diminishing_value,date(2017,6,1),
        date(2019,10,2),car123,_,1,true,general_pool,0,Total_depreciation_value),
    assertion(floats_close_enough(Total_depreciation_value, 546.7114669107006)).

test(depreciation_between_start_date_and_other_date_while_in_pool_2,[all(x=[x])]):-
    /* Parameters of predicate
    Initial_value, 							% value at start of year / Asset Base Value
    Method, 								% Diminishing Value / Prime Cost
    date(From_year, From_Month, From_day),  % Start date
    To_date,								% date for which depreciation should be computed
    Asset_id,								% Asset
    Rates,
    Depreciation_year, 						% 1,2,3...
    While_in_pool,
    What_pool,
    Initial_depreciation_value,
    Total_depreciation_value*/
    depreciation_between_start_date_and_other_date(2000,diminishing_value,date(2015,3,16),
        date(2019,10,2),car456,_,1,true,general_pool,0,Total_depreciation_value),
    assertion(floats_close_enough(Total_depreciation_value, 1556.4080604522424)).


test(depreciation_between_start_date_and_other_date_while_in_pool_3):-
    /* Parameters of predicate
    Initial_value, 							% value at start of year / Asset Base Value
    Method, 								% Diminishing Value / Prime Cost
    date(From_year, From_Month, From_day),
    To_date,								% date for which depreciation should be computed
    Asset_id,								% Asset
    Rates,
    Depreciation_year, 						% 1,2,3...
    While_in_pool,
    What_pool,
    Initial_depreciation_value,
    Total_depreciation_value*/
    Asset_id = car123,
    asset(Asset_id,Cost,Start_date,_),
    depreciation_between_start_date_and_other_date(Cost,diminishing_value,Start_date,
        date(2019,2,2),Asset_id,_,1,true,general_pool,0,Total_depreciation_value),
    assertion(floats_close_enough(Total_depreciation_value, 423.32831447468874)).

test(depreciation_between_start_date_and_other_date_while_in_pool_4):-
    /* Parameters of predicate
    Initial_value, 							% value at start of year / Asset Base Value
    Method, 								% Diminishing Value / Prime Cost
    date(From_year, From_Month, From_day),  % Start date
    To_date,								% date for which depreciation should be computed
    Asset_id,								% Asset
    Rates,
    Depreciation_year, 						% 1,2,3...
    While_in_pool,
    What_pool,
    Initial_depreciation_value,
    Total_depreciation_value*/
    Asset_id = car456,
    asset(Asset_id,Cost,Start_date,_),
    depreciation_between_start_date_and_other_date(Cost,diminishing_value,Start_date,
        date(2019,2,2),Asset_id,_,1,true,general_pool,0,Total_depreciation_value),
    assertion(floats_close_enough(Total_depreciation_value, 1435.6642782886095)).

test(written_down_value_asset_1):-
    Asset_id = car123,
    asset(Asset_id,Cost,Start_date,_),
    Written_down_date = date(2019,2,2),
    Method = diminishing_value,
    depreciation_between_start_date_and_other_date(Cost,diminishing_value,Start_date,
        Written_down_date,car123,_,1,false,_,0,Total_depreciation_value),
    written_down_value(Asset_id, Written_down_date, Method, _, Written_down_value),
    Remaining_value is Cost - Total_depreciation_value,
    assertion(floats_close_enough(Written_down_value, Remaining_value)).

test(written_down_value_asset_2):-
    Asset_id = car456,
    Written_down_date = date(2019,2,2),
    Method = diminishing_value,
    written_down_value(Asset_id, Written_down_date, Method, _, Written_down_value),
    assertion(floats_close_enough(Written_down_value, 532.9252925877597)).

test(written_down_value_asset_3):-
    Asset_id = car123,
    Written_down_date = date(2017,6,1),
    Method = diminishing_value,
    written_down_value(Asset_id, Written_down_date, Method, _, Written_down_value),
    assertion(floats_close_enough(Written_down_value, 966.027397260274)).

test(written_down_value_asset_4):-
    Asset_id = car456,
    Written_down_date = date(2017,6,1),
    Method = diminishing_value,
    written_down_value(Asset_id, Written_down_date, Method, _, Written_down_value),
    assertion(floats_close_enough(Written_down_value, 958.2641496788701)).

test(written_down_value_asset_5, fail):-
    %It should fail because at this date car456 wasnt purchased yet
    Asset_id = car456,
    Written_down_date = date(2014,6,1),
    Method = diminishing_value,
    written_down_value(Asset_id, Written_down_date, Method, _, Written_down_value),
    assertion(floats_close_enough(Written_down_value, 977.3206045515285)).

